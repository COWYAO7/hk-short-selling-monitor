<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ¸¯è‚¡å–ç©ºåå•ç›‘æ§ç³»ç»Ÿ - å®æ—¶è¿½è¸ªæ¸¯äº¤æ‰€å¯è¿›è¡Œå–ç©ºçš„æŒ‡å®šè¯åˆ¸åå•å˜åŒ–">
    <title>æ¸¯è‚¡å–ç©ºåå•ç›‘æ§</title>
    
    <!-- æ ·å¼ -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-container">
                <a href="index.html" class="navbar-brand">
                    <span class="icon">ğŸ“Š</span>
                    <span>æ¸¯è‚¡å–ç©ºç›‘æ§</span>
                </a>
                <ul class="navbar-nav">
                    <li><a href="index.html" class="nav-link">é¦–é¡µ</a></li>
                    <li><a href="list.html" class="nav-link">å®Œæ•´åå•</a></li>
                    <li><a href="history.html" class="nav-link">å†å²è®°å½•</a></li>
                    <li><a href="stats.html" class="nav-link">ç»Ÿè®¡åˆ†æ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹ -->
    <main>
        <div class="container">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="page-header">
                <h1 class="page-title">æœ€æ–°å˜åŒ–</h1>
                <p class="page-subtitle">å®æ—¶è¿½è¸ªæ¸¯äº¤æ‰€å–ç©ºåå•æ›´æ–°</p>
            </div>

            <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“‹</div>
                    <div class="stat-value primary" id="currentTotal">-</div>
                    <div class="stat-label">å½“å‰æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ•</div>
                    <div class="stat-label">æœ€åæ›´æ–°</div>
                    <div class="stat-value" style="font-size: 1.2rem;" id="lastUpdate">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-value success" id="recentAdded">-</div>
                    <div class="stat-label">æœ€è¿‘æ–°å¢</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“‰</div>
                    <div class="stat-value danger" id="recentRemoved">-</div>
                    <div class="stat-label">æœ€è¿‘ç§»é™¤</div>
                </div>
            </div>

            <!-- æœ€æ–°å˜åŒ–æ—¶é—´çº¿ -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“œ æœ€æ–°å˜åŒ–è®°å½•</h2>
                </div>
                <div class="card-body">
                    <div id="changeTimeline" class="timeline">
                        <!-- åŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer style="text-align: center; padding: 3rem 0; color: var(--text-muted);">
        <p>æ•°æ®æ¥æºï¼š<a href="https://www.hkex.com.hk" target="_blank" style="color: var(--accent-primary);">é¦™æ¸¯äº¤æ˜“æ‰€</a></p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">æ¯å¤©åŒ—äº¬æ—¶é—´ 9:00 å’Œ 18:00 è‡ªåŠ¨æ›´æ–°</p>
    </footer>

    <!-- è„šæœ¬ -->
    <script src="js/utils.js"></script>
    <script>
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                showLoading('changeTimeline');
                
                // å¹¶è¡ŒåŠ è½½å½“å‰æ•°æ®å’Œå†å²æ•°æ®
                const [currentData, historyData] = await Promise.all([
                    loadJSON('data/current.json'),
                    loadJSON('data/history.json')
                ]);
                
                // æ›´æ–°æ ¸å¿ƒæŒ‡æ ‡
                updateStats(currentData, historyData);
                
                // æ¸²æŸ“æœ€æ–°å˜åŒ–
                renderTimeline(historyData);
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                showError('changeTimeline', 'æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(currentData, historyData) {
            // å½“å‰æ€»æ•°
            document.getElementById('currentTotal').textContent = formatNumber(currentData.total);
            
            // æœ€åæ›´æ–°æ—¶é—´
            document.getElementById('lastUpdate').textContent = formatDate(currentData.date);
            
            // æœ€è¿‘ä¸€æ¬¡å˜åŒ–çš„æ–°å¢å’Œç§»é™¤æ•°
            if (historyData && historyData.length > 0) {
                const latestChange = historyData[0];
                document.getElementById('recentAdded').textContent = latestChange.added.length;
                document.getElementById('recentRemoved').textContent = latestChange.removed.length;
            } else {
                document.getElementById('recentAdded').textContent = '0';
                document.getElementById('recentRemoved').textContent = '0';
            }
        }

        // æ¸²æŸ“æ—¶é—´çº¿
        function renderTimeline(historyData) {
            const timeline = document.getElementById('changeTimeline');
            
            if (!historyData || historyData.length === 0) {
                showEmpty('changeTimeline', 'æš‚æ— å˜åŒ–è®°å½•');
                return;
            }
            
            // åªæ˜¾ç¤ºæœ€è¿‘10æ¡
            const recentChanges = historyData.slice(0, 10);
            
            let html = '';
            recentChanges.forEach(change => {
                const netChange = change.net_change;
                const netChangeClass = netChange > 0 ? 'text-success' : netChange < 0 ? 'text-danger' : '';
                const netChangeIcon = netChange > 0 ? 'ğŸ“ˆ' : netChange < 0 ? 'ğŸ“‰' : 'â–';
                
                html += `
                    <div class="timeline-item">
                        <div class="timeline-date">${formatDate(change.date)}</div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <span class="badge badge-success">æ–°å¢ ${change.added.length}</span>
                                    <span class="badge badge-danger" style="margin-left: 0.5rem;">ç§»é™¤ ${change.removed.length}</span>
                                </div>
                                <div class="${netChangeClass}" style="font-weight: 600;">
                                    ${netChangeIcon} ${netChange > 0 ? '+' : ''}${netChange}
                                </div>
                            </div>
                `;
                
                // æ–°å¢è‚¡ç¥¨
                if (change.added.length > 0) {
                    html += '<div style="margin-bottom: 1rem;">';
                    html += '<div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--accent-green);">ğŸ“ˆ æ–°å¢:</div>';
                    html += '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">';
                    change.added.forEach(stock => {
                        html += `
                            <span style="background: rgba(0, 255, 136, 0.1); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.9rem;">
                                <span class="stock-code">${stock.code}</span> ${stock.name}
                            </span>
                        `;
                    });
                    html += '</div></div>';
                }
                
                // ç§»é™¤è‚¡ç¥¨
                if (change.removed.length > 0) {
                    html += '<div>';
                    html += '<div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--accent-red);">ğŸ“‰ ç§»é™¤:</div>';
                    html += '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">';
                    change.removed.forEach(stock => {
                        html += `
                            <span style="background: rgba(255, 107, 107, 0.1); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.9rem;">
                                <span class="stock-code">${stock.code}</span> ${stock.name}
                            </span>
                        `;
                    });
                    html += '</div></div>';
                }
                
                html += '</div></div>';
            });
            
            timeline.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        loadData();
    </script>
</body>
</html>
