name: æ¸¯è‚¡å–ç©ºåå•ç›‘æ§

on:
  # å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©åŒ—äº¬æ—¶é—´ 9:00 å’Œ 18:00
  schedule:
    - cron: '0 1 * * *'   # UTC 1:00 = åŒ—äº¬æ—¶é—´ 9:00
    - cron: '0 10 * * *'  # UTC 10:00 = åŒ—äº¬æ—¶é—´ 18:00
  
  # æ”¯æŒæ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # éœ€è¦å†™æƒé™æ¥æäº¤æ•°æ®æ–‡ä»¶
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´å†å²ï¼Œç”¨äºæäº¤
      
      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          pip install -r scripts/requirements.txt
      
      - name: è¿è¡Œç›‘æ§è„šæœ¬
        env:
          GMAIL_ADDRESS: ${{ secrets.GMAIL_ADDRESS }}
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
          WEBSITE_URL: ${{ secrets.WEBSITE_URL }}
          RECIPIENT_EMAIL: ${{ secrets.RECIPIENT_EMAIL }}
        run: |
          cd scripts
          python main.py
      
      - name: æäº¤æ•°æ®å˜åŒ–
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # æ·»åŠ æ•°æ®æ–‡ä»¶
          git add docs/data/*.json
          
          # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
          if git diff --staged --quiet; then
            echo "æ— æ•°æ®å˜åŒ–ï¼Œè·³è¿‡æäº¤"
          else
            git commit -m "ğŸ¤– æ›´æ–°å–ç©ºåå•æ•°æ® - $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "âœ“ æ•°æ®å·²æäº¤å¹¶æ¨é€"
          fi
